schema: '2.0'
stages:
  download_dataset:
    cmd: ( wget https://storage.googleapis.com/mledu-datasets/cats_and_dogs_filtered.zip
      -O cats_and_dogs_filtered.zip && unzip cats_and_dogs_filtered.zip -d ./data/raw
      && rm cats_and_dogs_filtered.zip ) &> logs/download_dataset.out
    outs:
    - path: ./data/raw
      md5: 174fe7fcb400140a007ac05c36b5bfd4.dir
      size: 68556316
      nfiles: 3001
    - path: logs/download_dataset.out
      md5: 22adf28a22be3a08b92bb9cc6fc44e9c
      size: 325768
  split_dataset:
    cmd: python scripts/split_dataset.py &> logs/split_dataset.out
    deps:
    - path: ./data/raw
      md5: 174fe7fcb400140a007ac05c36b5bfd4.dir
      size: 68556316
      nfiles: 3001
    - path: scripts/split_dataset.py
      md5: 89168a688a7d1c3b17f17e6d0bac4f01
      size: 1360
    params:
      params.yaml:
        data.dataset.val_test_split:
          val: 0.7
          test: 0.3
    outs:
    - path: ./data/dataset/dataset.csv
      md5: 81f2a20dfec1c8d7fe98efed8a6c5bb6
      size: 68097
    - path: ./data/dataset/test
      md5: 29aaa52dd33820bc43a13ffdd775e2fd.dir
      size: 6711947
      nfiles: 294
    - path: ./data/dataset/train
      md5: 0a1a83aa537b94b2b07eb1503701eca7.dir
      size: 45613376
      nfiles: 2000
    - path: ./data/dataset/val
      md5: b3ca96a52677ddfc568664f181f1c1bf.dir
      size: 16230853
      nfiles: 706
    - path: logs/split_dataset.out
      md5: 7d592b252af87a5f90fa0726c7906ff4
      size: 2567
  train:
    cmd: python scripts/train.py &> logs/train.out
    deps:
    - path: ./data/dataset/train
      md5: 0a1a83aa537b94b2b07eb1503701eca7.dir
      size: 45613376
      nfiles: 2000
    - path: ./data/dataset/val
      md5: b3ca96a52677ddfc568664f181f1c1bf.dir
      size: 16230853
      nfiles: 706
    - path: scripts/train.py
      md5: cb43505107166a1c5f2e6f6dd0ffd991
      size: 3165
    params:
      params.yaml:
        model:
          backbone: tensorflow.keras.applications.MobileNetV2
          preprocess_input: tensorflow.keras.applications.mobilenet_v2.preprocess_input
        train:
          batch_size: 32
          img_size:
          - 160
          - 160
          learning_rate: 0.0001
          seed: 43
          subdir: train
          epochs:
            frozen: 3
            unfrozen: 3
          fine_tune_at: 100
    outs:
    - path: ./data/train/best_weights.h5
      md5: 96e3008a2cfc0f22b50d4f36714741ed
      size: 16919992
    - path: ./data/train/model
      md5: fc013b3857184bd4cdf15f7792abf7a8.dir
      size: 20574998
      nfiles: 4
    - path: ./data/train/tensorboard
      md5: 2ef6c7fd9de1b395702e4f3a36f43cb7.dir
      size: 1297391
      nfiles: 4
    - path: logs/train.out
      md5: 21e8c75a88be44d8386b8c45ed14f569
      size: 68243
  evaluate:
    cmd: python scripts/evaluate.py &> logs/evaluate.out
    deps:
    - path: ./data/dataset/test
      md5: 29aaa52dd33820bc43a13ffdd775e2fd.dir
      size: 6711947
      nfiles: 294
    - path: ./data/train/model
      md5: fc013b3857184bd4cdf15f7792abf7a8.dir
      size: 20574998
      nfiles: 4
    - path: scripts/evaluate.py
      md5: 6e906b98af0ef9451137beb95f889e95
      size: 1341
    outs:
    - path: ./data/evaluation/metrics.json
      md5: 5ed94d20813337144aeca3a58c2ed048
      size: 56
    - path: ./data/evaluation/predictions.csv
      md5: a28f1b43e8fcbc5d9d768625841a9fe0
      size: 44363
    - path: logs/evaluate.out
      md5: 7be506709124e84bfef1ee5096fa2446
      size: 500
