schema: '2.0'
stages:
  download_dataset:
    cmd: ( wget https://storage.googleapis.com/mledu-datasets/cats_and_dogs_filtered.zip
      -O cats_and_dogs_filtered.zip && unzip cats_and_dogs_filtered.zip -d ./data/raw
      && rm cats_and_dogs_filtered.zip ) &> logs/download_dataset.out
    outs:
    - path: ./data/raw
      md5: 174fe7fcb400140a007ac05c36b5bfd4.dir
      size: 68556316
      nfiles: 3001
    - path: logs/download_dataset.out
      md5: 22adf28a22be3a08b92bb9cc6fc44e9c
      size: 325768
  split_dataset:
    cmd: python scripts/split_dataset.py &> logs/split_dataset.out
    deps:
    - path: ./data/raw
      md5: 174fe7fcb400140a007ac05c36b5bfd4.dir
      size: 68556316
      nfiles: 3001
    - path: scripts/split_dataset.py
      md5: 89168a688a7d1c3b17f17e6d0bac4f01
      size: 1360
    params:
      params.yaml:
        data.dataset.val_test_split:
          val: 0.7
          test: 0.3
    outs:
    - path: ./data/dataset/dataset.csv
      md5: 81f2a20dfec1c8d7fe98efed8a6c5bb6
      size: 68097
    - path: ./data/dataset/test
      md5: 29aaa52dd33820bc43a13ffdd775e2fd.dir
      size: 6711947
      nfiles: 294
    - path: ./data/dataset/train
      md5: 0a1a83aa537b94b2b07eb1503701eca7.dir
      size: 45613376
      nfiles: 2000
    - path: ./data/dataset/val
      md5: b3ca96a52677ddfc568664f181f1c1bf.dir
      size: 16230853
      nfiles: 706
    - path: logs/split_dataset.out
      md5: 7d592b252af87a5f90fa0726c7906ff4
      size: 2567
  train:
    cmd: python scripts/train.py &> logs/train.out
    deps:
    - path: ./data/dataset/train
      md5: 0a1a83aa537b94b2b07eb1503701eca7.dir
      size: 45613376
      nfiles: 2000
    - path: ./data/dataset/val
      md5: b3ca96a52677ddfc568664f181f1c1bf.dir
      size: 16230853
      nfiles: 706
    - path: scripts/train.py
      md5: 1b7ea8cd0e09169a0fd283b860e8bbc4
      size: 3350
    params:
      params.yaml:
        model:
          backbone: tensorflow.keras.applications.MobileNetV2
          preprocess_input: tensorflow.keras.applications.mobilenet_v2.preprocess_input
        train:
          batch_size: 32
          img_size:
          - 160
          - 160
          learning_rate: 0.0001
          seed: 42
          subdir: train
          epochs:
            frozen: 1
            unfrozen: 2
          fine_tune_at: 100
    outs:
    - path: ./data/train/best_weights.h5
      md5: 69f5cc8605638f121db08da8fe1b1984
      size: 16919992
    - path: ./data/train/model
      md5: f3c3221befd2191b1651d7f165b74a55.dir
      size: 20574998
      nfiles: 4
    - path: ./data/train/tensorboard
      md5: b2f2f874390766f8bf36cf97c939870c.dir
      size: 1296013
      nfiles: 4
    - path: logs/train.out
      md5: 06532879dbdb6c2aaed1043efaf5ce94
      size: 36372
  evaluate:
    cmd: python scripts/evaluate.py &> logs/evaluate.out
    deps:
    - path: ./data/dataset/test
      md5: 29aaa52dd33820bc43a13ffdd775e2fd.dir
      size: 6711947
      nfiles: 294
    - path: ./data/train/model
      md5: f3c3221befd2191b1651d7f165b74a55.dir
      size: 20574998
      nfiles: 4
    - path: scripts/evaluate.py
      md5: 6e906b98af0ef9451137beb95f889e95
      size: 1341
    outs:
    - path: ./data/evaluation/metrics.json
      md5: 3db0fa7cbfee2db42de2f5c95be6886a
      size: 56
    - path: ./data/evaluation/predictions.csv
      md5: 4497feaa05aaa54ae4aa5bf2a4a96e23
      size: 44220
    - path: logs/evaluate.out
      md5: af94bd87db3fd4025a941e0d7b05922f
      size: 500
